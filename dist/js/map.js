var WIKI_EXTRACT_BASE_QUERY="https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exsentences=2&exlimit=1&explaintext=true&titles=";var map;var infoWindow;var defaultIcon;var highlightedIcon;var initMap=function(){map=new google.maps.Map(document.getElementById('map'),{center:{lat:12.9716,lng:77.5946},zoom:13});infoWindow=new google.maps.InfoWindow({});infoWindow.addListener('closeclick',function(){infoWindow.marker=null;});defaultIcon=makeMarkerIcon('ff0000');highlightedIcon=makeMarkerIcon('00ffff');google.maps.event.addDomListener(window,"resize",resizeMap);ko.applyBindings(new LocationsViewModel());};var mapError=function(){document.getElementById('map').innerHTML="Error loading Map!";};var resizeMap=function(){var center=map.getCenter();google.maps.event.trigger(map,"resize");map.setCenter(center);};var createMarker=function(location){var marker=new google.maps.Marker({position:location.position,map:map,title:location.title,icon:defaultIcon,animation:google.maps.Animation.DROP,});return marker;};var addMarkerListeners=function(marker){marker.addListener('click',function(){markerClicked(this);});marker.addListener('mouseover',function(){this.setIcon(highlightedIcon);});marker.addListener('mouseout',function(){this.setIcon(defaultIcon);});};var markerClicked=function(marker){bounceMarker(marker);showInfoWindow(marker);};var bounceMarker=function(marker){marker.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){marker.setAnimation(null);},700);};var showInfoWindow=function(marker){if(infoWindow.marker!=marker){infoWindow.marker=marker;loadWikiInfo(marker);}};var showMarker=function(marker){marker.setMap(map);};var hideMarker=function(marker){marker.setMap(null);};var makeMarkerIcon=function(markerColor){var markerIconImage=new google.maps.MarkerImage('http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|'+markerColor+'|40|_|%E2%80%A2',new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34));return markerIconImage;};var loadWikiInfo=function(marker){var wikiURL=WIKI_EXTRACT_BASE_QUERY+marker.title;$.ajax({url:wikiURL,dataType:"jsonp",timeout:10000,success:function(data){if(data&&data.query&&data.query.pages){var pages=data.query.pages;for(var pageid in pages){infoWindow.setContent('<h4>'+marker.title+'</h4>'+'<p>'+pages[pageid].extract+'</p>');}} else{infoWindow.setContent('<h4>'+marker.title+'</h4>');} infoWindow.open(map,marker);},error:function(jqXHR,textStatus,errorThrown){infoWindow.setContent('<h4>'+marker.title+'</h4>'+'<p>'+errorThrown+': Failed to load the wikipedia information</p>');infoWindow.open(map,marker);}});};