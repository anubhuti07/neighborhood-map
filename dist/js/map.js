var WIKI_EXTRACT_BASE_QUERY="https://en.wikipedia.org/w/api.php?action=query&format=json&prop=extracts&exsentences=2&exlimit=1&explaintext=true&titles=";var locations=[{title:'Lal Bagh',position:{lat:12.9507,lng:77.5848}},{title:'UB City',position:{lat:12.9719,lng:77.5962}},{title:'M. Chinnaswamy Stadium',position:{lat:12.9790,lng:77.5994}},{title:'Vidhana Soudha',position:{lat:12.9765,lng:77.5888}},{title:'Nehru Planetarium',position:{lat:12.9849,lng:77.5896}},{title:'Bangalore Fort',position:{lat:12.9629,lng:77.5761}},{title:'Hard Rock Cafe',position:{lat:12.9762,lng:77.6016}}];var map;var infoWindow;var infoWindowContent='<div id = "info-window">'+'<h4 id = "infowin-title"></h4>'+'<p id = "infowin-extract"></p>'+'</div>';var defaultIcon;var highlightedIcon;var initMap=function(){map=new google.maps.Map(document.getElementById('map'),{center:{lat:12.9716,lng:77.5946},zoom:13});infoWindow=new google.maps.InfoWindow({content:infoWindowContent});infoWindow.addListener('closeclick',function(){infoWindow.marker=null;});defaultIcon=makeMarkerIcon('ff0000');highlightedIcon=makeMarkerIcon('00ffff');google.maps.event.addDomListener(window,"resize",resizeMap);ko.applyBindings(new LocationsViewModel());};var resizeMap=function(){var center=map.getCenter();google.maps.event.trigger(map,"resize");map.setCenter(center);};var createMarker=function(location){var marker=new google.maps.Marker({position:location.position,map:map,title:location.title,icon:defaultIcon,animation:google.maps.Animation.DROP,});return marker;};var addMarkerListeners=function(marker){marker.addListener('click',function(){markerClicked(this);});marker.addListener('mouseover',function(){this.setIcon(highlightedIcon);});marker.addListener('mouseout',function(){this.setIcon(defaultIcon);});};var markerClicked=function(marker){bounceMarker(marker);showInfoWindow(marker);};var bounceMarker=function(marker){marker.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){marker.setAnimation(null);},800);};var showInfoWindow=function(marker){if(infoWindow.marker!=marker){infoWindow.marker=marker;loadWikiInfo(marker);}};var showMarker=function(marker){marker.setMap(map);};var hideMarker=function(marker){marker.setMap(null);};var makeMarkerIcon=function(markerColor){var markerIconImage=new google.maps.MarkerImage('http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|'+markerColor+'|40|_|%E2%80%A2',new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34));return markerIconImage;};var loadWikiInfo=function(marker){var wikiURL=WIKI_EXTRACT_BASE_QUERY+marker.title;var wikiRequestTimeout=setTimeout(function(){document.getElementById('infowin-title').innerHTML=marker.title;document.getElementById('infowin-extract').innerHTML="Failed to load the wikipedia information";infoWindow.open(map,marker);},8000);$.ajax({url:wikiURL,dataType:"jsonp",success:function(data){if(data&&data.query&&data.query.pages){var pages=data.query.pages;for(var pageid in pages){infoWindow.open(map,marker);document.getElementById('infowin-title').innerHTML=marker.title;document.getElementById('infowin-extract').innerHTML=pages[pageid].extract;}} else{document.getElementById('infowin-title').innerHTML=marker.title;} infoWindow.open(map,marker);clearTimeout(wikiRequestTimeout);},error:function(data){document.getElementById('infowin-title').innerHTML=marker.title;document.getElementById('infowin-extract').innerHTML="Failed to load the wikipedia information";infoWindow.open(map,marker);}});};